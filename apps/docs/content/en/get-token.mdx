# How to Get an Access Token

This guide explains how to obtain an access token using your OAuth client credentials via the UMS API.

## Prerequisites

- A valid `client_id` and `client_secret` (obtained from [creating a client](./create-client))
- The UMS API base URL

## API Endpoint

**Endpoint**: `POST /auth/v1/oauth-apps/token`

**Base URL**: <EnvVar name="UMS_BASE_URL" />

**Full URL**: <EnvVar name="UMS_BASE_URL" />/auth/v1/oauth-apps/token

## Request Format

### Headers

```
Content-Type: application/json
```

### Request Body

The request body should be sent as `application/json` with the following fields:

```json
{
  "client_id": "your-client-id",
  "client_secret": "your-client-secret"
}
```

**Required fields:**
- `client_id`: Your OAuth client ID (required)
- `client_secret`: Your OAuth client secret (required)

## Response Format

### Success Response

```json
{
  "access_token": "eyJhbGciOiJSUzI1NiIs...",
  "token_type": "bearer",
  "expires_in": 3600
}
```

### Error Response

```json
{
  "error": "invalid_client",
  "error_description": "Client authentication failed"
}
```

## Code Examples

### JavaScript/TypeScript (Fetch API)

```typescript
async function getToken(clientId: string, clientSecret: string): Promise<string> {
  const umsBaseUrl = process.env.UMS_BASE_URL || 'https://ums.example.com';

  const response = await fetch(`${umsBaseUrl}/auth/v1/oauth-apps/token`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      client_id: clientId,
      client_secret: clientSecret,
    }),
  });
  
  if (!response.ok) {
    const error = await response.json();
    throw new Error(`Failed to get token: ${error.error || response.statusText}`);
  }
  
  const data = await response.json();
  return data.access_token;
}

// Usage example
try {
  const token = await getToken('your-client-id', 'your-client-secret');
  console.log('Access Token:', token);
  
  // Use the token to make authenticated API calls
  const apiResponse = await fetch('https://api.example.com/data', {
    headers: {
      'Authorization': `Bearer ${token}`,
    },
  });
} catch (error) {
  console.error('Error:', error);
}
```

### Python (requests library)

```python
import requests
import os

def get_token(client_id: str, client_secret: str) -> str:
    """Get OAuth access token using client credentials via UMS API."""
    ums_base_url = os.getenv('UMS_BASE_URL', 'https://ums.example.com')
    response = requests.post(
        f'{ums_base_url}/auth/v1/oauth-apps/token',
        json={
            'client_id': client_id,
            'client_secret': client_secret,
        },
        headers={'Content-Type': 'application/json'}
    )
    response.raise_for_status()
    data = response.json()
    return data['access_token']

# Usage example
try:
    token = get_token('your-client-id', 'your-client-secret')
    print(f'Access Token: {token}')
    
    # Use the token to make authenticated API calls
    api_response = requests.get(
        'https://api.example.com/data',
        headers={'Authorization': f'Bearer {token}'}
    )
    api_response.raise_for_status()
except requests.exceptions.RequestException as e:
    print(f'Error: {e}')
```

### cURL

```bash
# Get token
# Replace <UMS_BASE_URL> with your actual UMS base URL (e.g., https://ums.example.com)
UMS_BASE_URL="<UMS_BASE_URL>"
curl -X POST "${UMS_BASE_URL}/auth/v1/oauth-apps/token" \
  -H "Content-Type: application/json" \
  -d '{
    "client_id": "your-client-id",
    "client_secret": "your-client-secret"
  }'

# Use token in API call
TOKEN=$(curl -s -X POST "${UMS_BASE_URL}/auth/v1/oauth-apps/token" \
  -H "Content-Type: application/json" \
  -d '{
    "client_id": "your-client-id",
    "client_secret": "your-client-secret"
  }' | jq -r '.access_token')

curl -H "Authorization: Bearer $TOKEN" \
  https://api.example.com/data
```

### Node.js (Native HTTP/HTTPS)

```javascript
const https = require('https');

function getToken(clientId, clientSecret) {
  return new Promise((resolve, reject) => {
    const umsBaseUrl = process.env.UMS_BASE_URL || 'https://ums.example.com';
    const url = new URL('/auth/v1/oauth-apps/token', umsBaseUrl);
    
    const data = JSON.stringify({
      client_id: clientId,
      client_secret: clientSecret,
    });

    const options = {
      hostname: url.hostname,
      path: url.pathname,
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Content-Length': data.length,
      },
    };

    const req = https.request(options, (res) => {
      let responseData = '';

      res.on('data', (chunk) => {
        responseData += chunk;
      });

      res.on('end', () => {
        if (res.statusCode === 200) {
          const result = JSON.parse(responseData);
          resolve(result.access_token);
        } else {
          reject(new Error(`Failed: ${res.statusCode} ${responseData}`));
        }
      });
    });

    req.on('error', (error) => {
      reject(error);
    });

    req.write(data);
    req.end();
  });
}

// Usage
getToken('your-client-id', 'your-client-secret')
  .then(token => {
    console.log('Access Token:', token);
  })
  .catch(error => {
    console.error('Error:', error);
  });
```

## Error Handling

Common error scenarios:

### Invalid Client Credentials

```json
{
  "error": "invalid_client",
  "error_description": "Client authentication failed"
}
```

**Solution**: Verify that your `client_id` and `client_secret` are correct.

### Missing Parameters

```json
{
  "error": "invalid_request",
  "error_description": "client_id is required"
}
```

**Solution**: Ensure both `client_id` and `client_secret` are included in the request body.

## Using the Access Token

Once you have the access token, include it in the `Authorization` header of your API requests:

```
Authorization: Bearer <access_token>
```

### Example API Call

```javascript
const response = await fetch('https://api.example.com/protected-resource', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json',
  },
});
```

## Token Expiration

Access tokens typically expire after a certain period (e.g., 3600 seconds / 1 hour). You'll need to:

1. Monitor the token expiration time
2. Request a new token before it expires
3. Handle 401 Unauthorized responses by refreshing the token

## Notes

- This endpoint uses the UMS API directly
- Store tokens securely and never expose them in client-side code
- Tokens are bearer tokens - anyone with the token can use it
- Always use HTTPS when making token requests

## Next Steps

- Learn about token refresh mechanisms
- Explore API endpoints that accept these tokens
- Implement token caching and refresh logic in your application
